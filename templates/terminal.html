{% extends "base.html" %}
{% block title %}Terminal - Control Server{% endblock %}
{% block body %}
<div class="app-shell">
  <aside class="sidebar">
    <div style="padding: 0 1.5rem 1rem; font-weight: 600;">Control Server</div>
    <nav>
      <a href="/dashboard">Dashboard</a>
      <a href="/cronjobs">Cronjob Manager</a>
      <a href="/logs">Log Server</a>
      <a href="/services">Services</a>
      <a href="/terminal" class="active">Terminal</a>
      <a href="#" id="logoutLink">Đăng xuất</a>
    </nav>
  </aside>
  <main class="main">
    <h1>Terminal</h1>
    <div id="terminalBox" class="card">
      <div id="terminalFrameWrap" style="display:none;">
        <iframe id="terminalFrame" src="" style="width:100%;height:70vh;border:1px solid var(--border);border-radius:var(--radius);background:#000;"></iframe>
      </div>
      <div id="terminalPlaceholder" class="text-muted">
        <p>Để sử dụng Web Terminal, cần cài <strong>ttyd</strong> và cấu hình <code>TTYD_URL</code> trong file .env</p>
        <p class="mt-2">Cài đặt:</p>
        <pre style="background:var(--bg-input);padding:1rem;border-radius:var(--radius);overflow:auto;"># Ubuntu/Debian
sudo apt install ttyd

# Chạy ttyd (port 7681)
ttyd -p 7681 -c admin:your_password bash
# Hoặc không auth (chỉ dùng nội bộ): ttyd -p 7681 bash</pre>
        <p class="mt-2">Thêm vào .env: <code>TTYD_URL=http://localhost:7681</code> (thay localhost bằng IP server nếu truy cập từ xa)</p>
      </div>
    </div>
  </main>
</div>
{% endblock %}
{% block scripts %}
<script>
document.getElementById('logoutLink').addEventListener('click', async (e) => {
  e.preventDefault();
  await fetch('/api/auth/logout', { method: 'POST', credentials: 'include' });
  window.location.href = '/login';
});
async function initTerminal() {
  const r = await fetch('/api/server/terminal-url', { credentials: 'include' });
  if (r.status === 401) { window.location.href = '/login'; return; }
  const j = await r.json();
  if (j.url) {
    document.getElementById('terminalPlaceholder').style.display = 'none';
    document.getElementById('terminalFrameWrap').style.display = 'block';
    document.getElementById('terminalFrame').src = j.url;
  }
}
initTerminal();
</script>
{% endblock %}
